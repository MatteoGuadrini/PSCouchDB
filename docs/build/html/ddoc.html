

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Design documents &mdash; PSCouchDB  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cmdlets and aliases" href="cmdlets.html" />
    <link rel="prev" title="Documents" href="documents.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PSCouchDB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html#nodes">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="permission.html">Permission</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html#replication">Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html#query">Query</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design documents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-a-design-document">Get a design document</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-design-document-attachment">Get design document attachment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creates-a-design-document">Creates a design document</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#views">Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation">Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-functions">Custom functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-design-document-attachment">Create design document attachment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modify-design-document-attachment">Modify design document attachment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compress-design-document">Compress design document</a></li>
<li class="toctree-l2"><a class="reference internal" href="#remove-design-document">Remove design document</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#remove-design-document-attachment">Remove design document attachment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cmdlets.html">Cmdlets and aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="uses.html">Real uses</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PSCouchDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Design documents</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ddoc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="design-documents">
<h1>Design documents<a class="headerlink" href="#design-documents" title="Permalink to this headline">¶</a></h1>
<p>In CouchDB, design documents provide the main interface for building a CouchDB application.
The design document defines the views used to extract information from CouchDB through one or more views.
Design documents are created within your CouchDB instance in the same way as you create database documents,
but the content and definition of the documents is different.</p>
<div class="section" id="get-a-design-document">
<h2>Get a design document<a class="headerlink" href="#get-a-design-document" title="Permalink to this headline">¶</a></h2>
<p>Returns the contents of the design document specified with the name of the design document and from the specified database.
Unless you request a specific revision, the latest revision of the document will always be returned.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;space&quot;</span>
</pre></div>
</div>
<p>To get all the Design Documents in a database.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDatabaseDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span>
</pre></div>
</div>
<p>In this table you can find all the possible parameters to get the design documents with this cmdlet.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>PARAMETER</p></th>
<th class="head"><p>DESCRIPTION</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Descending</p></td>
<td><p>Return the design documents in descending by key order. Default is false.</p></td>
</tr>
<tr class="row-odd"><td><p>EndKey</p></td>
<td><p>Stop returning records when the specified key is reached.</p></td>
</tr>
<tr class="row-even"><td><p>EndKeyDocument</p></td>
<td><p>Stop returning records when the specified design document ID is reached.</p></td>
</tr>
<tr class="row-odd"><td><p>IncludeDocument</p></td>
<td><p>Include the full content of the design documents in the return. Default is false.</p></td>
</tr>
<tr class="row-even"><td><p>InclusiveEnd</p></td>
<td><p>Specifies whether the specified end key should be included in the result. Default is true.</p></td>
</tr>
<tr class="row-odd"><td><p>Key</p></td>
<td><p>Return only design documents that match the specified key.</p></td>
</tr>
<tr class="row-even"><td><p>Keys</p></td>
<td><p>Return only design documents that match the specified keys.</p></td>
</tr>
<tr class="row-odd"><td><p>Conflict</p></td>
<td><p>Includes conflicts information in response. Ignored if include_docs isn’t true. Default is false.</p></td>
</tr>
<tr class="row-even"><td><p>Limit</p></td>
<td><p>Limit the number of the returned design documents to the specified number.</p></td>
</tr>
<tr class="row-odd"><td><p>Skip</p></td>
<td><p>Skip this number of records before starting to return the results. Default is 0.</p></td>
</tr>
<tr class="row-even"><td><p>StartKey</p></td>
<td><p>Return records starting with the specified key.</p></td>
</tr>
<tr class="row-odd"><td><p>StartKeyDocument</p></td>
<td><p>Return records starting with the specified design document ID.</p></td>
</tr>
<tr class="row-even"><td><p>UpdateSequence</p></td>
<td><p>Response includes an update_seq value indicating which sequence id of the underlying database the view reflects. Default is false.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="get-design-document-attachment">
<h3>Get design document attachment<a class="headerlink" href="#get-design-document-attachment" title="Permalink to this headline">¶</a></h3>
<p>To retrieve or save an attachment in a design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDesignDocumentAttachment</span> <span class="n">-Database</span> <span class="n">test2</span> <span class="n">-Document</span> <span class="n">space</span> <span class="n">-Attachment</span> <span class="n">test</span><span class="p">.</span><span class="n">txt</span> <span class="n">-OutFile</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creates-a-design-document">
<h2>Creates a design document<a class="headerlink" href="#creates-a-design-document" title="Permalink to this headline">¶</a></h2>
<p>Creates a new named design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">New-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;space&quot;</span> <span class="n">-ViewName</span> <span class="s2">&quot;planet_view&quot;</span> <span class="n">-ViewMapFunction</span> <span class="s2">&quot;function(doc){if(doc.planet &amp;&amp; doc.name) {emit(doc.planet, doc.name);}}&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<div class="section" id="views">
<h3>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<p>The definition of a view within a design document also creates an index based on the key information defined within each view. The production and use of the index significantly increases the speed of access and searching or selecting documents from the view.
However, the index is not updated when new documents are added or modified in the database.
View indexes are updated incrementally in the following situations:</p>
<ul class="simple">
<li><p>A new document has been added to the database.</p></li>
<li><p>A document has been deleted from the database.</p></li>
<li><p>A document in the database has been updated.</p></li>
</ul>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">New-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;space&quot;</span> <span class="n">-ViewName</span> <span class="s2">&quot;planet_view&quot;</span> <span class="n">-ViewMapFunction</span> <span class="s2">&quot;function(doc){if(doc.planet &amp;&amp; doc.name) {emit(doc.planet, doc.name);}}&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Now, navigate with your favorite browser to <code class="docutils literal notranslate"><span class="pre">http://localhost:5984/test/_design/space/_view/planet_view</span></code> or</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;_design/space/_view/planet_view&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="validation">
<h3>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h3>
<p>A design document may contain a function named <code class="docutils literal notranslate"><span class="pre">validate_doc_update</span></code> which can be used to prevent invalid or unauthorized document update requests from being stored.
Only one function is allowed at a time.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Set-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;space&quot;</span> <span class="n">-Revision</span> <span class="s2">&quot;1-88972423aac3fe5d474dd17d3ee18a8b&quot;</span> <span class="n">-ValidationFunction</span> <span class="s2">&quot;function(newDoc, oldDoc, userCtx, secObj){if (!(newDoc.name || newDoc.planet)) {throw({forbidden : &#39;no way&#39;});}&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Now try to creates a new document without validation element</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nv">$data</span> <span class="p">=</span> <span class="s1">&#39;{&quot;planet&quot;:&quot;Magrathea&quot;}&#39;</span>
<span class="nb">New-CouchDBDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;Test_Validation&quot;</span> <span class="n">-Data</span> <span class="nv">$data</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Received an error: <code class="docutils literal notranslate"><span class="pre">Invoke-RestMethod</span> <span class="pre">:</span> <span class="pre">{&quot;error&quot;:&quot;forbidden&quot;,&quot;reason&quot;:&quot;no</span> <span class="pre">way&quot;}</span></code>. Now retry with this:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nv">$data</span> <span class="p">=</span> <span class="s1">&#39;{&quot;planet&quot;:&quot;Magrathea&quot;, &quot;name&quot;:&quot;Slartibartfast&quot;}&#39;</span>
<span class="nb">New-CouchDBDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;Test_Validation&quot;</span> <span class="n">-Data</span> <span class="nv">$data</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-functions">
<h3>Custom functions<a class="headerlink" href="#custom-functions" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to define a custom Design Document, creating a here string that defines the document itself.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nv">$ddoc</span> <span class="p">=</span> <span class="sh">@&#39;</span>
<span class="sh">{</span>
<span class="sh">    &quot;language&quot;: &quot;javascript&quot;,</span>
<span class="sh">    &quot;views&quot;: {</span>
<span class="sh">        &quot;all&quot;: {</span>
<span class="sh">            &quot;map&quot;: &quot;function(doc) { emit(doc.title, doc) }&quot;</span>
<span class="sh">        },</span>
<span class="sh">        &quot;by_title&quot;: {</span>
<span class="sh">            &quot;map&quot;: &quot;function(doc) { if (doc.title != null) emit(doc.title, doc) }&quot;</span>
<span class="sh">        },</span>
<span class="sh">        &quot;by_planet&quot;: {</span>
<span class="sh">            &quot;map&quot;: &quot;function(doc) { for(i=0;i&lt;doc.keywords.lenghth();i++) { emit(doc.keywords[i], doc); } }&quot;</span>
<span class="sh">        }</span>
<span class="sh">    },</span>
<span class="sh">    &quot;shows&quot;: {</span>
<span class="sh">        &quot;planet&quot;: &quot;function(doc, req) { return &#39;&lt;h1&gt;&#39; + doc.title + &#39;&lt;/h1&gt;&#39; }&quot;</span>
<span class="sh">    }</span>
<span class="sh">}</span>
<span class="sh">&#39;@</span>
<span class="nb">New-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="n">space</span> <span class="n">-Data</span> <span class="nv">$ddoc</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-design-document-attachment">
<h3>Create design document attachment<a class="headerlink" href="#create-design-document-attachment" title="Permalink to this headline">¶</a></h3>
<p>To create an attachment in a design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Add-CouchDBDesignDocumentAttachment</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="n">space</span> <span class="n">-Attachment</span> <span class="s2">&quot;C:\test.txt&quot;</span> <span class="n">-Revision</span> <span class="n">3-cfae968df80635ad15a9709e0264a988</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-design-document-attachment">
<h3>Modify design document attachment<a class="headerlink" href="#modify-design-document-attachment" title="Permalink to this headline">¶</a></h3>
<p>To modify or add an attachment in a design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Add-CouchDBDesignDocumentAttachment</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="n">space</span> <span class="n">-Attachment</span> <span class="s2">&quot;C:\test2.txt&quot;</span> <span class="n">-Revision</span> <span class="n">4-cfae968df80635ad15d5709e0264a988</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compress-design-document">
<h2>Compress design document<a class="headerlink" href="#compress-design-document" title="Permalink to this headline">¶</a></h2>
<p>The compaction operation is the way to reduce disk space usage by removing unused and old data from database or view index files.
This operation is very similar to the vacuum (SQLite ex.) operation available for other database management systems.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Compress-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-DesignDoc</span> <span class="n">space</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-design-document">
<h2>Remove design document<a class="headerlink" href="#remove-design-document" title="Permalink to this headline">¶</a></h2>
<p>To remove a design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Remove-CouchDBDesignDocument</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="s2">&quot;mydesigndoc&quot;</span> <span class="n">-Revision</span> <span class="s2">&quot;1-85a961d0d9b235b7b4f07baed1a38fda&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<div class="section" id="remove-design-document-attachment">
<h3>Remove design document attachment<a class="headerlink" href="#remove-design-document-attachment" title="Permalink to this headline">¶</a></h3>
<p>To remove an attachment in a design document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Remove-CouchDBDesignDocumentAttachment</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Document</span> <span class="n">space</span> <span class="n">-Attachment</span> <span class="s2">&quot;C:\test2.txt&quot;</span> <span class="n">-Revision</span> <span class="n">5-cfae778df80635ad15daa09e0264a988</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cmdlets.html" class="btn btn-neutral float-right" title="Cmdlets and aliases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="documents.html" class="btn btn-neutral float-left" title="Documents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Matteo Guadrini

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

	<style>
		/* Sidebar header (and topbar for mobile) */
		.wy-side-nav-search, .wy-nav-top {
			background: #1B2C3E;
		}
		/* Sidebar */
		.wy-nav-side {
			background: #2A425E;
		}
	</style>



</body>
</html>
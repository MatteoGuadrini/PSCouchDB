

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Server operation &mdash; PSCouchDB  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication" href="auth.html" />
    <link rel="prev" title="Permission" href="permission.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PSCouchDB
          

          
            
            <img src="_static/pscouchdb-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html#nodes">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="permission.html">Permission</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#read-the-log">Read the log</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#level">Level</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clear-the-log">Clear the log</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#replication">Replication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-replica">Get replica</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-replica">Create replica</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modify-replica">Modify replica</a></li>
<li class="toctree-l2"><a class="reference internal" href="#remove-replica">Remove replica</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replication-request">Replication request</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html#query">Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddoc.html">Design documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmdlets.html">Preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmdlets.html#cmdlets-and-aliases">Cmdlets and aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="uses.html">Real uses</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PSCouchDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Server operation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="server-operation">
<h1>Server operation<a class="headerlink" href="#server-operation" title="Permalink to this headline">¶</a></h1>
<p>Most of the cmdlets in this module are based on the <code class="docutils literal notranslate"><span class="pre">Send-CouchDBRequest</span></code> cmdlet.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Send-CouchDBRequest</span> <span class="c"># alias creq</span>
<span class="nb">Get-Help</span> <span class="nb">Send-CouchDBRequest</span> <span class="n">-Full</span>
</pre></div>
</div>
<p>Below are all the cmdlets needed to get all the information on the CouchDB server.</p>
<p>To get the version and other info on the server, run:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBServer</span>
</pre></div>
</div>
<p>To get list of running tasks, including the task type, name, status and process ID:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBActiveTask</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get list of all the databases in the CouchDB instance:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDatabase</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get information of a list of the specified databases in the CouchDB instance:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDatabaseInfo</span> <span class="n">-Keys</span> <span class="n">test</span><span class="p">,</span><span class="n">test1</span><span class="p">,</span><span class="n">test2</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get the status of the node or cluster, run this:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBClusterSetup</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get a list of all database events in the CouchDB instance:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDatabaseUpdates</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>For other parameter see the table below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 93%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>PARAMETER</p></th>
<th class="head"><p>DESCRIPTION</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Feed</p></td>
<td><dl>
<dt>Option:</dt><dd><p><strong>normal</strong>: Returns all historical DB changes, then closes the connection. Default.</p>
<p><strong>longpoll</strong>: Closes the connection after the first event.</p>
<p><strong>continuous</strong>: Send a line of JSON per event. Keeps the socket open until timeout.</p>
<p><strong>eventsource</strong>: Like, continuous, but sends the events in EventSource format.</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>Timeout</p></td>
<td><p>Number of seconds until CouchDB closes the connection. Default is 60.</p></td>
</tr>
<tr class="row-even"><td><p>Heartbeat</p></td>
<td><p>Period in milliseconds after which an empty line is sent in the results. Only applicable for longpoll, continuous, and eventsource feeds. Overrides any timeout to keep the feed alive indefinitely. Default is 60000.</p></td>
</tr>
<tr class="row-odd"><td><p>Since</p></td>
<td><p>Return only updates since the specified sequence ID. May be the string “now” to begin showing only new updates.</p></td>
</tr>
</tbody>
</table>
<p>To displays the nodes that are part of the cluster:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBNode</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get the statistics for the running server:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Measure-CouchDBStatistics</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
<span class="nb">Measure-CouchDBStatistics</span> <span class="n">-System</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To restart server:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This task required privileged access on operating system</p>
</div>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Restart-CouchDBServer</span>
</pre></div>
</div>
<p>And check health:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBServer</span> <span class="n">-Status</span>
</pre></div>
</div>
<p>To get one or more Universally Unique Identifiers (UUIDs) from the CouchDB instance:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">New-CouchDBUuids</span>
</pre></div>
</div>
<p>To set proxy server for all calls:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Set-CouchDBProxy</span> <span class="n">-Server</span> <span class="s1">&#39;http://myproxy.local:8080&#39;</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>
</pre></div>
</div>
<p>And remove it</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Remove-CouchDBProxy</span>
</pre></div>
</div>
<p>Tests the results of Lucene analyzer tokenization on sample text:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Search-CouchDBAnalyze</span> <span class="n">-Field</span> <span class="s2">&quot;english&quot;</span> <span class="n">-Text</span> <span class="s2">&quot;running&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Returns a count of completed, failed, running, stopped, and total jobs along with the state of resharding on the cluster:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBReshards</span> <span class="n">-Jobs</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>This starts global resharding on all the nodes of the cluster:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Set-CouchDBReshards</span> <span class="n">-State</span> <span class="n">running</span> <span class="n">-StateReason</span> <span class="s2">&quot;Test start&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Single resharding job for a particular range:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Set-CouchDBReshards</span> <span class="n">-Database</span> <span class="n">test</span> <span class="n">-Err</span> <span class="s2">&quot;Test message&quot;</span> <span class="n">-Type</span> <span class="n">split</span> <span class="n">-Range</span> <span class="s2">&quot;80000000-ffffffff&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Stop and remove specific job id:</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Remove-CouchDBReshards</span> <span class="n">-JobId</span> <span class="s2">&quot;001-638b90b9acf73cbb113afdfdba458bec80da6a6be23599019fb7b051cedfcc93&quot;</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<div class="section" id="read-the-log">
<h2>Read the log<a class="headerlink" href="#read-the-log" title="Permalink to this headline">¶</a></h2>
<p>To read entire log.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Read-CouchDBLog</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default path is specified in the server configuration. Run `` Get-CouchDBConfiguration -Session log -Key file -Authorization admin:password``.
Otherwise, specify the path using the <code class="docutils literal notranslate"><span class="pre">-Path</span></code> parameter.</p>
</div>
<p>This example is used to read only the last 15 lines of log.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Read-CouchDBLog</span> <span class="n">-Tail</span> <span class="n">15</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Instead this to stay in append on the log for the level of warning.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Read-CouchDBLog</span> <span class="n">-Level</span> <span class="n">warning</span> <span class="n">-Follow</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<div class="section" id="level">
<h3>Level<a class="headerlink" href="#level" title="Permalink to this headline">¶</a></h3>
<p>Each entry in the log has its own color, so as to identify the line of interest “at a glance”.</p>
<style type="text/css"><!--
 .goldenrod {color: goldenrod;}
 .dimgray {color: dimgray;}
 .gray {color: gray;}
 .yellow {color: yellow;}
 .red {color: red;}
 .darkred {color: darkred;}
 .darkmagenta {color: darkmagenta;}
 .magenta {color: magenta;}
 --></style><p><span class="goldenrod">debug</span> : Detailed debug logging.</p>
<p><span class="dimgray">info</span> : Informative logging. Includes HTTP requests headlines, startup of an external processes etc.</p>
<p><span class="gray">notice</span></p>
<p><span class="yellow">warning</span> : Warning messages are alerts about edge situations that may lead to errors.</p>
<p><span class="red">error</span> : Error level includes only things that go wrong, like crash reports and HTTP error responses (5xx codes).</p>
<p><span class="darkred">critical</span></p>
<p><span class="darkmagenta">alert</span></p>
<p><span class="magenta">emergency</span></p>
</div>
</div>
<div class="section" id="clear-the-log">
<h2>Clear the log<a class="headerlink" href="#clear-the-log" title="Permalink to this headline">¶</a></h2>
<p>Clear entire and rotate (save a copy in the same folder) log.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Clear-CouchDBLog</span> <span class="n">-Rotate</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="replication">
<h1>Replication<a class="headerlink" href="#replication" title="Permalink to this headline">¶</a></h1>
<p>The replication is an incremental one way process involving two databases (a source and a destination).</p>
<div class="section" id="get-replica">
<h2>Get replica<a class="headerlink" href="#get-replica" title="Permalink to this headline">¶</a></h2>
<p>To get a replication document.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBReplication</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>To get a list of replication jobs.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBReplicationScheduler</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>And to get a list of replication document states.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBReplicationDocument</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-replica">
<h2>Create replica<a class="headerlink" href="#create-replica" title="Permalink to this headline">¶</a></h2>
<p>Creation of the replicator database and replication agent is automatically in the same time.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">module</span> <span class="n">PSCouchDB</span>
<span class="nv">$rep</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">PSCouchDBReplication</span> <span class="n">-ArgumentList</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;test_dump&#39;</span>
<span class="nv">$rep</span><span class="p">.</span><span class="n">SetContinuous</span><span class="p">()</span>
<span class="nb">New-CouchDBReplication</span> <span class="n">-Data</span> <span class="nv">$rep</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
<p>Now that we have a replicated document, let’s take a look at the change.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Get-CouchDBDatabaseChanges</span> <span class="n">-Database</span> <span class="n">test_dump</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-replica">
<h2>Modify replica<a class="headerlink" href="#modify-replica" title="Permalink to this headline">¶</a></h2>
<p>To change the replication agent settings (continuous: true | false).</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">module</span> <span class="n">PSCouchDB</span>
<span class="nv">$rep</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">PSCouchDBReplication</span> <span class="n">-ArgumentList</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;test_dump&#39;</span>
<span class="nv">$rep</span><span class="p">.</span><span class="n">SetRevision</span><span class="p">(</span><span class="s2">&quot;4-c2cefa18494e47182a125b11eccecd13&quot;</span><span class="p">)</span>
<span class="nb">Set-CouchDBReplication</span> <span class="n">-Data</span> <span class="nv">$rep</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-replica">
<h2>Remove replica<a class="headerlink" href="#remove-replica" title="Permalink to this headline">¶</a></h2>
<p>To remove the replication agent.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="nb">Remove-CouchDBReplication</span> <span class="n">-Document</span> <span class="n">test_test_dump</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="replication-request">
<h2>Replication request<a class="headerlink" href="#replication-request" title="Permalink to this headline">¶</a></h2>
<p>Request, configure, or stop, a replication operation.</p>
<div class="highlight-powershell notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">module</span> <span class="n">PSCouchDB</span>
<span class="nv">$rep</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">PSCouchDBReplication</span> <span class="n">-ArgumentList</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;test_dump&#39;</span>
<span class="nv">$rep</span><span class="p">.</span><span class="n">AddDocIds</span><span class="p">(@(</span><span class="s2">&quot;Hitchhikers&quot;</span><span class="p">,</span><span class="s2">&quot;Hitchhikers_Guide&quot;</span><span class="p">))</span>
<span class="nb">Request-CouchDBReplication</span> <span class="n">-Data</span> <span class="nv">$rep</span> <span class="n">-Authorization</span> <span class="s2">&quot;admin:password&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="auth.html" class="btn btn-neutral float-right" title="Authentication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="permission.html" class="btn btn-neutral float-left" title="Permission" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Matteo Guadrini

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

	<style>
		/* Sidebar header (and topbar for mobile) */
		.wy-side-nav-search, .wy-nav-top {
			background: #1B2C3E;
		}
		/* Sidebar */
		.wy-nav-side {
			background: #2A425E;
		}
	</style>



</body>
</html>